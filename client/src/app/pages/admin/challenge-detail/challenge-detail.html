<div class="challenge-detail-container">
  <header class="header">
    <div class="header-left">
      <button class="btn-back" (click)="goBack()">‚Üê Êàª„Çã</button>
      <h1>ÂïèÈ°åË©≥Á¥∞</h1>
    </div>
    <div class="header-actions">
      <button class="theme-toggle" (click)="themeService.toggleTheme()" title="„ÉÜ„Éº„ÉûÂàá„ÇäÊõø„Åà">
        @if (themeService.isDark()) {
          ‚òÄÔ∏è
        } @else {
          üåô
        }
      </button>
    </div>
  </header>

  @if (isLoading()) {
    <div class="loading">Ë™≠„ÅøËæº„Åø‰∏≠...</div>
  } @else if (error()) {
    <div class="error-message">{{ error() }}</div>
  } @else if (challenge()) {
    <div class="detail-wrapper">
      <!-- Â∑¶ÂÅ¥ÔºöË©≥Á¥∞ÊÉÖÂ†± -->
      <div class="detail-card">
        <div class="challenge-header">
          <span class="challenge-genre">{{ challenge()!.genre }}</span>
          <h2 class="challenge-name">{{ challenge()!.name }}</h2>
          <div class="challenge-points">{{ challenge()!.points }} pts</div>
        </div>

        <div class="challenge-info">
          <div class="info-section">
            <h3>Ë™¨Êòé</h3>
            <div class="description-content">{{ challenge()!.description }}</div>
          </div>

          <div class="info-section">
            <h3>„Éï„É©„Ç∞</h3>
            <code class="code-display">{{ challenge()!.flag }}</code>
          </div>

          <div class="info-section">
            <h3>Challenge ID</h3>
            <code class="code-display">{{ challenge()!.challengeId }}</code>
          </div>
        </div>

        <div class="actions">
          <button class="btn-primary" (click)="editChallenge()">Á∑®ÈõÜ</button>
          <button class="btn-danger" (click)="deleteChallenge()">ÂâäÈô§</button>
        </div>

        <!-- „Éì„É´„Éâ„É≠„Ç∞Êäò„ÇäÁï≥„Åø„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div class="build-logs-section">
          <button class="build-logs-toggle" (click)="toggleBuildLogs()">
            <span class="toggle-icon">{{ buildLogsExpanded() ? '‚ñº' : '‚ñ∂' }}</span>
            <span>„Éì„É´„Éâ„É≠„Ç∞ ({{ buildLogs().length }})</span>
            @if (isPolling()) {
              <span class="polling-indicator">üîÑ Êõ¥Êñ∞‰∏≠...</span>
            }
          </button>

          @if (buildLogsExpanded()) {
            <div class="build-logs-content">
              @if (isLoadingLogs()) {
                <div class="loading-small">Ë™≠„ÅøËæº„Åø‰∏≠...</div>
              } @else if (buildLogs().length === 0) {
                <div class="no-logs">„Éì„É´„Éâ„É≠„Ç∞„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</div>
              } @else {
                <div class="build-logs-list">
                  @for (log of buildLogs(); track log.jobId) {
                    <div class="build-log-item">
                      <button
                        class="build-log-header"
                        type="button"
                        (click)="viewBuildLog(log.jobId)"
                        [class.expanded]="selectedLog()?.jobId === log.jobId"
                      >
                        <span class="log-status" [class]="getStatusClass(log.status)">
                          {{ getStatusLabel(log.status) }}
                        </span>
                        <span class="log-date">{{ log.createdAt }}</span>
                        <span class="log-expand-icon">{{
                          selectedLog()?.jobId === log.jobId ? '‚ñº' : '‚ñ∂'
                        }}</span>
                      </button>
                      @if (selectedLog()?.jobId === log.jobId) {
                        <div class="build-log-content">
                          @if (isLoadingLogContent()) {
                            <div class="loading-small">Ë™≠„ÅøËæº„Åø‰∏≠...</div>
                          } @else {
                            <pre class="log-output">{{
                              selectedLog()!.content || '„É≠„Ç∞„Åå„ÅÇ„Çä„Åæ„Åõ„Çì'
                            }}</pre>
                          }
                        </div>
                      }
                    </div>
                  }
                </div>
              }
            </div>
          }
        </div>
      </div>

      <!-- Âè≥ÂÅ¥Ôºö„Éó„É¨„Éì„É•„Éº -->
      <div class="preview-card">
        <h2>„Éó„É¨„Éì„É•„Éº</h2>
        <div class="preview-content">
          <div class="preview-header">
            <span class="preview-genre">{{ challenge()!.genre }}</span>
            <h3 class="preview-name">{{ challenge()!.name }}</h3>
            <div class="preview-points">{{ challenge()!.points }} pts</div>
          </div>

          <div class="preview-description">
            <h4>Ë™¨Êòé</h4>
            <div class="preview-description-content">
              <p>{{ challenge()!.description }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  }
</div>
