<div class="challenge-detail-container">
  <header class="header">
    <div class="header-left">
      <button class="btn-back" (click)="goBack()">â† æˆ»ã‚‹</button>
      <h1>å•é¡Œè©³ç´°</h1>
    </div>
    <div class="header-actions">
      <button class="theme-toggle" (click)="themeService.toggleTheme()" title="ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ">
        @if (themeService.isDark()) {
        â˜€ï¸
        } @else {
        ğŸŒ™
        }
      </button>
    </div>
  </header>

  @if (isLoading()) {
  <div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>
  } @else if (error()) {
  <div class="error-message">{{ error() }}</div>
  } @else if (challenge()) {
  <div class="detail-wrapper">
    <!-- å·¦å´ï¼šè©³ç´°æƒ…å ± -->
    <div class="detail-card">
      <div class="challenge-header">
        <span class="challenge-genre">{{ challenge()!.genre }}</span>
        <h2 class="challenge-name">{{ challenge()!.name }}</h2>
        <div class="challenge-points">{{ challenge()!.points }} pts</div>
      </div>

      <div class="challenge-info">
        <div class="info-section">
          <h3>èª¬æ˜</h3>
          <div class="description-content">{{ challenge()!.description }}</div>
        </div>

        <div class="info-section">
          <h3>ãƒ•ãƒ©ã‚°</h3>
          <code class="code-display">{{ challenge()!.flag }}</code>
        </div>

        <div class="info-section">
          <h3>Challenge ID</h3>
          <code class="code-display">{{ challenge()!.challengeId }}</code>
        </div>
      </div>

      <div class="actions">
        <button class="btn-primary" (click)="editChallenge()">ç·¨é›†</button>
        <button class="btn-danger" (click)="deleteChallenge()">å‰Šé™¤</button>
      </div>

      <!-- ãƒ“ãƒ«ãƒ‰ãƒ­ã‚°æŠ˜ã‚Šç•³ã¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div class="build-logs-section">
        <button class="build-logs-toggle" (click)="toggleBuildLogs()">
          <span class="toggle-icon">{{ buildLogsExpanded() ? 'â–¼' : 'â–¶' }}</span>
          <span>ãƒ“ãƒ«ãƒ‰ãƒ­ã‚° ({{ buildLogs().length }})</span>
          @if (isPolling()) {
          <span class="polling-indicator">ğŸ”„ æ›´æ–°ä¸­...</span>
          }
        </button>

        @if (buildLogsExpanded()) {
        <div class="build-logs-content">
          @if (isLoadingLogs()) {
          <div class="loading-small">èª­ã¿è¾¼ã¿ä¸­...</div>
          } @else if (buildLogs().length === 0) {
          <div class="no-logs">ãƒ“ãƒ«ãƒ‰ãƒ­ã‚°ã¯ã‚ã‚Šã¾ã›ã‚“</div>
          } @else {
          <div class="build-logs-list">
            @for (log of buildLogs(); track log.jobId) {
            <div class="build-log-item">
              <button class="build-log-header" type="button" (click)="viewBuildLog(log.jobId)"
                [class.expanded]="selectedLog()?.jobId === log.jobId">
                <span class="log-status" [class]="getStatusClass(log.status)">
                  {{ getStatusLabel(log.status) }}
                </span>
                <span class="log-date">{{ log.createdAt }}</span>
                <span class="log-expand-icon">{{
                  selectedLog()?.jobId === log.jobId ? 'â–¼' : 'â–¶'
                  }}</span>
              </button>
              @if (selectedLog()?.jobId === log.jobId) {
              <div class="build-log-content">
                @if (isLoadingLogContent()) {
                <div class="loading-small">èª­ã¿è¾¼ã¿ä¸­...</div>
                } @else {
                <pre class="log-output">{{
                              selectedLog()!.content || 'ãƒ­ã‚°ãŒã‚ã‚Šã¾ã›ã‚“'
                            }}</pre>
                }
              </div>
              }
            </div>
            }
          </div>
          }
        </div>
        }
      </div>
    </div>

    <!-- å³å´ï¼šãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
    <div class="preview-card">
      <h2>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
      <div class="preview-content">
        <div class="preview-header">
          <span class="preview-genre">{{ challenge()!.genre }}</span>
          <h3 class="preview-name">{{ challenge()!.name }}</h3>
          <div class="preview-points">{{ challenge()!.points }} pts</div>
        </div>

        <div class="preview-description">
          <h4>èª¬æ˜</h4>
          <div class="preview-description-content">
            <p>{{ challenge()!.description }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  }
</div>