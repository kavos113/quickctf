<div class="challenges-page">
  <header class="header">
    <div class="header-content">
      <h1>CTF Challenges</h1>
      <div class="user-info">
        <span class="username">{{ username() }}</span>
        <button class="theme-toggle" (click)="themeService.toggleTheme()" title="ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ">
          @if (themeService.isDark()) {
          â˜€ï¸
          } @else {
          ğŸŒ™
          }
        </button>
        <button class="admin-button" (click)="goToAdmin()">
          @if (adminService.isAdmin()) {
          ç®¡ç†ç”»é¢
          } @else {
          ç®¡ç†è€…
          }
        </button>
        <button class="logout-button" (click)="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
      </div>
    </div>
  </header>

  <main class="main-content">
    @if (isLoading()) {
    <div class="loading">
      <div class="spinner"></div>
      <p>èª­ã¿è¾¼ã¿ä¸­...</p>
    </div>
    } @else if (error()) {
    <div class="error-message">
      <p>{{ error() }}</p>
      <button (click)="challengeService.loadChallenges()">å†èª­ã¿è¾¼ã¿</button>
    </div>
    } @else {
    <div class="genre-filter">
      <button class="genre-button" [class.active]="selectedGenre() === null" (click)="selectGenre(null)">
        ã™ã¹ã¦
      </button>
      @for (genre of genres; track genre) {
      <button class="genre-button" [class.active]="selectedGenre() === genre" (click)="selectGenre(genre)">
        {{ genre }}
      </button>
      }
    </div>

    <div class="challenges-grid">
      @for (challenge of filteredChallenges; track challenge.name) {
      <button class="challenge-card" (click)="openChallenge(challenge)">
        <div class="challenge-genre">{{ challenge.genre }}</div>
        <h3 class="challenge-name">{{ challenge.name }}</h3>
        <div class="challenge-points">{{ challenge.points }} pts</div>
      </button>
      } @empty {
      <p class="no-challenges">å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“</p>
      }
    </div>
    }
  </main>

  @if (selectedChallenge()) {
  <app-challenge-detail [challenge]="selectedChallenge()!" (closeModal)="closeChallenge()" />
  }
</div>