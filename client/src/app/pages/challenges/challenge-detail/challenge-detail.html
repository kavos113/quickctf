<div
  class="modal-overlay"
  (click)="onOverlayClick($event)"
  (keydown.escape)="onClose()"
  tabindex="0"
  role="dialog"
  aria-modal="true"
>
  <div class="modal-content">
    <button class="close-button" (click)="onClose()" aria-label="é–‰ã˜ã‚‹">Ã—</button>

    <div class="challenge-header">
      <span class="challenge-genre">{{ challenge.genre }}</span>
      <h2 class="challenge-name">{{ challenge.name }}</h2>
      <div class="challenge-points">{{ challenge.points }} pts</div>
    </div>

    <div class="challenge-description">
      <h3>èª¬æ˜</h3>
      <p>{{ challenge.description }}</p>
    </div>

    @if (challenge.attachments.length > 0) {
      <div class="attachments-section">
        <h3>æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«</h3>
        <div class="attachments-list">
          @for (attachment of challenge.attachments; track attachment.attachmentId) {
            <a [href]="attachment.url" target="_blank" class="attachment-link">
              <span class="attachment-icon">ğŸ“</span>
              <span class="attachment-name">{{ attachment.filename }}</span>
              <span class="attachment-size">({{ formatFileSize(attachment.size) }})</span>
            </a>
          }
        </div>
      </div>
    }

    @if (challenge.requiresInstance) {
      <div class="instance-section">
        <h3>ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹</h3>
        @if (isRunning()) {
          <div class="instance-status">
            <span class="status-badge running">å®Ÿè¡Œä¸­</span>
          </div>
          <div class="instance-access">
            <div>
              web:
              <a
                class="code-block"
                href="http://{{ instanceConnectionInfo()?.host }}:{{
                  instanceConnectionInfo()?.port
                }}"
                target="_blank"
                rel="noopener noreferrer"
              >
                http://{{ instanceConnectionInfo()?.host }}:{{ instanceConnectionInfo()?.port }}
              </a>
            </div>
            <div>
              pwn:
              <span class="code-block">
                nc {{ instanceConnectionInfo()?.host }} {{ instanceConnectionInfo()?.port }}
              </span>
            </div>
          </div>
          <button
            class="instance-button stop"
            (click)="stopInstance()"
            [disabled]="isInstanceLoading()"
          >
            @if (isInstanceLoading()) {
              åœæ­¢ä¸­...
            } @else {
              ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’åœæ­¢
            }
          </button>
        } @else {
          <button
            class="instance-button start"
            (click)="startInstance()"
            [disabled]="isInstanceLoading()"
          >
            @if (isInstanceLoading()) {
              èµ·å‹•ä¸­...
            } @else {
              ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’èµ·å‹•
            }
          </button>
        }
      </div>
    }

    <div class="flag-section">
      <h3>ãƒ•ãƒ©ã‚°ã‚’æå‡º</h3>
      @if (submitResult()) {
        <div
          class="submit-result"
          [class.success]="submitResult()?.type === 'success'"
          [class.error]="submitResult()?.type === 'error'"
          [class.wrong]="submitResult()?.type === 'wrong'"
        >
          {{ submitResult()?.message }}
        </div>
      }
      <form (ngSubmit)="submitFlag()">
        <div class="flag-input-group">
          <input
            type="text"
            placeholder="flag{...}"
            [value]="flag()"
            (input)="updateFlag($event)"
            [disabled]="isSubmitting()"
          />
          <button type="submit" [disabled]="isSubmitting() || !flag()">
            @if (isSubmitting()) {
              é€ä¿¡ä¸­...
            } @else {
              æå‡º
            }
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
