syntax = "proto3";

package api.server.v1;

import "api/server/v1/model.proto";

service AdminService {
  rpc CreateChallenge(CreateChallengeRequest) returns (CreateChallengeResponse);
  rpc UpdateChallenge(UpdateChallengeRequest) returns (UpdateChallengeResponse);
  rpc UploadChallengeImage(UploadChallengeImageRequest) returns (UploadChallengeImageResponse);
  rpc DeleteChallenge(DeleteChallengeRequest) returns (DeleteChallengeResponse);
  rpc ListChallenges(ListChallengesRequest) returns (ListChallengesResponse);
  rpc GetChallenge(GetChallengeRequest) returns (GetChallengeResponse);
  rpc ListBuildLogs(ListBuildLogsRequest) returns (ListBuildLogsResponse);
  rpc GetBuildLog(GetBuildLogRequest) returns (GetBuildLogResponse);
}

message CreateChallengeRequest {
  ChallengeRequest challenge = 1;
}

message CreateChallengeResponse {
  string challenge_id = 1;
  string error_message = 2;
}

message UpdateChallengeRequest {
  Challenge challenge = 1;
}

message UpdateChallengeResponse {
  string error_message = 1;
}

message UploadChallengeImageRequest {
  string challenge_id = 1;
  bytes image_data = 2;
}

message UploadChallengeImageResponse {
  string job_id = 1;
  string error_message = 2;
}

message DeleteChallengeRequest {
  string challenge_id = 1;
}

message DeleteChallengeResponse {
  string error_message = 1;
}

message ListChallengesRequest {}

message ListChallengesResponse {
  repeated Challenge challenges = 1;
  string error_message = 2;
}

message GetChallengeRequest {
  string challenge_id = 1;
}

message GetChallengeResponse {
  Challenge challenge = 1;
  string error_message = 2;
}

message BuildLogSummary {
  string job_id = 1;
  string challenge_id = 2;
  string status = 3;
  string created_at = 4;
  string completed_at = 5;
}

message ListBuildLogsRequest {
  string challenge_id = 1; // optional, filter by challenge
}

message ListBuildLogsResponse {
  repeated BuildLogSummary logs = 1;
  string error_message = 2;
}

message GetBuildLogRequest {
  string job_id = 1;
}

message GetBuildLogResponse {
  string job_id = 1;
  string log_content = 2;
  string status = 3;
  string error_message = 4;
}

service AdminAuthService {
  rpc AdminLogin(AdminLoginRequest) returns (AdminLoginResponse);
  rpc AdminLogout(AdminLogoutRequest) returns (AdminLogoutResponse);
}

message AdminLoginRequest {
  string password = 1;
}

message AdminLoginResponse {}
message AdminLogoutRequest {}
message AdminLogoutResponse {}
